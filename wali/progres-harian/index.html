<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Laporan Harian Santri â€“ CAHAYA APP</title>
  <style>
    :root {
      --bg1: #0f766e;
      --bg2: #064e3b;
      --accent: #22c55e;
      --accent2: #0ea5e9;
      --text-main: #f9fafb;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: "Poppins", sans-serif;
      background: radial-gradient(circle at top, #0f766e 0%, #022c22 55%, #020617 100%);
      color: var(--text-main);
      min-height: 100vh;
    }
    .page { max-width: 1100px; margin: 0 auto; padding: 24px 16px 40px; }

    /* HEADER */
    .app-title {
      text-align: center;
      margin-bottom: 10px;
    }
    .app-title h1 {
      font-size: 1.5rem;
      font-weight: 700;
      letter-spacing: 0.5px;
      margin-bottom: 4px;
    }
    .app-title p {
      font-size: 1rem;
      opacity: 0.9;
    }

    .top-bar {
      display: flex; justify-content: space-between; align-items: center;
      flex-wrap: wrap; gap: 12px; margin-bottom: 20px;
    }
    .top-left-label {
      font-weight: 600; font-size: 0.95rem;
      padding: 8px 16px; border-radius: 999px;
      background: linear-gradient(135deg, #0d9488, #0f766e);
      box-shadow: 0 3px 6px rgba(0,0,0,0.3);
      color: #fff; white-space: nowrap;
    }

    /* BUTTON BAR */
    .button-bar {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 15px;
    }
    .btn-top {
      padding: 8px 16px;
      border: none;
      border-radius: 8px;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: 0.25s;
      color: white;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }
    .btn-dashboard {
      background: linear-gradient(135deg, var(--accent2), #0284c7);
    }
    .btn-logout {
      background: linear-gradient(135deg, #dc2626, #b91c1c);
    }
    .btn-top:hover {
      transform: translateY(-1px);
      opacity: 0.9;
    }

    /* FILTER */
    .filter-area {
      display: flex; align-items: center; gap: 8px;
      flex-wrap: nowrap; justify-content: flex-end;
    }
    .filter-area span { font-size: 0.9rem; opacity: 0.9; white-space: nowrap; }
    .filter-area input[type="date"] {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: #fff; border-radius: 8px;
      padding: 6px 10px; font-size: 0.9rem;
    }
    .filter-area input[type="date"]::-webkit-calendar-picker-indicator { filter: invert(1); cursor: pointer; }
    .btn-main {
      border-radius: 8px; border: none; padding: 7px 14px;
      font-size: 0.9rem; font-weight: 600; cursor: pointer;
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: white; box-shadow: 0 3px 6px rgba(0,0,0,0.4);
      transition: 0.2s; white-space: nowrap;
    }
    .btn-main:hover { transform: translateY(-1px); box-shadow: 0 5px 10px rgba(0,0,0,0.5); }

    @media (max-width: 640px) {
      .top-bar { flex-direction: column; align-items: stretch; gap: 8px; }
      .filter-area { width: 100%; justify-content: space-between; }
      .btn-main, .btn-top { width: 100%; font-size: 0.9rem; padding: 8px 0; }
      .button-bar { justify-content: center; }
    }

    /* TABS */
    .tabs { display: none; gap: 10px; margin-bottom: 16px; flex-wrap: wrap; }
    .tab-btn {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255,255,255,0.3);
      color: #f1f5f9; border-radius: 8px;
      padding: 6px 14px; font-size: 0.9rem;
      cursor: pointer; transition: 0.2s;
    }
    .tab-btn.active {
      background: linear-gradient(135deg, #22c55e, #16a34a);
      border-color: transparent; color: #fff;
      box-shadow: 0 3px 10px rgba(16,185,129,0.5);
    }
    .tab-btn:hover:not(.active) { background: rgba(255,255,255,0.15); }

    /* CARD */
    .card {
      background: rgba(15, 23, 42, 0.5);
      border-radius: 14px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.4);
      padding: 16px 20px; margin-bottom: 20px;
      backdrop-filter: blur(10px);
    }
    .card-header { font-weight: 600; font-size: 1rem; margin-bottom: 10px; display: flex; align-items: center; gap: 8px; }
    table {
      width: 100%; border-collapse: collapse;
      font-size: 0.86rem; background: rgba(15,23,42,0.4);
      border-radius: 12px; overflow: hidden;
    }
    th, td {
      padding: 8px 10px; border: 1px solid rgba(255,255,255,0.15);
      text-align: left; color: #f8fafc;
    }
    th {
      background: rgba(255,255,255,0.15);
      font-weight: 600; text-transform: capitalize;
    }
    .badge {
      display: inline-block; padding: 3px 8px;
      border-radius: 999px; font-size: 0.75rem; font-weight: 600;
    }
    .badge-hadir { background: #16a34a; color: #e5ffe9; }
    .badge-izin { background: #0ea5e9; color: #e0f2fe; }
    .badge-sakit { background: #eab308; color: #111827; }
    .badge-alfa { background: #ef4444; color: #fee2e2; }
    .no-data { text-align: center; opacity: 0.8; padding: 20px; font-size: 0.9rem; }
    footer { text-align: center; font-size: 0.8rem; opacity: 0.75; margin-top: 20px; }

    @media (max-width: 640px) {
      table { font-size: 0.75rem; }
      th, td { padding: 6px; }
    }
  </style>
</head>
<body>
<div class="page">

  <div class="app-title">
    <h1>ğŸŒ CAHAYA APP</h1>
    <p>ğŸ•Œ Pesantren Cahaya Fajrul Islam</p>
  </div>

  <div class="top-bar">
    <div class="top-left-label">ğŸ“Š Progres Harian</div>
    <div class="filter-area">
      <span>Tanggal:</span>
      <input type="date" id="tanggalInput">
      <button class="btn-main" id="btnTampil">ğŸ” Tampilkan Progres</button>
    </div>
  </div>

  <div class="button-bar">
    <button class="btn-top btn-dashboard" onclick="goDashboard()">ğŸ  Dashboard</button>
    <button class="btn-top btn-logout" onclick="logout()">ğŸšª Keluar</button>
  </div>

  <div id="tabs" class="tabs">
    <button class="tab-btn active" data-tab="program">ğŸ“‹ Program</button>
    <button class="tab-btn" data-tab="pembelajaran">ğŸ“˜ Pembelajaran</button>
    <button class="tab-btn" data-tab="tahfiz">ğŸ“– Tahfiz</button>
    <button class="tab-btn" data-tab="pelanggaran">âš ï¸ Pelanggaran</button>
  </div>

  <main id="panelContainer">
    <p style="text-align:center;opacity:0.8;">Pilih tanggal, lalu klik <b>Tampilkan Progres</b> untuk melihat laporan harian santri.</p>
  </main>

  <footer>Â© 2025 Pesantren Cahaya Fajrul Islam â€” CAHAYA APP</footer>
</div>

<!-- ğŸ”¥ SCRIPT -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getDatabase, ref, get, child } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyB0Ez2a85ZwQLR28U-yHpVmM3o8NMxZoLI",
    authDomain: "absensi-santri-fajrul-islam.firebaseapp.com",
    databaseURL: "https://absensi-santri-fajrul-islam-default-rtdb.firebaseio.com",
    projectId: "absensi-santri-fajrul-islam",
    storageBucket: "absensi-santri-fajrul-islam.appspot.com",
    messagingSenderId: "739928369926",
    appId: "1:739928369926:web:7e95375c3ddba0f584cdd07"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const tanggalInput = document.getElementById("tanggalInput");
  const btnTampil = document.getElementById("btnTampil");
  const tabsEl = document.getElementById("tabs");
  const panelContainer = document.getElementById("panelContainer");

  const currentUser = JSON.parse(localStorage.getItem("cahayaCurrentUser") || "null");
  if (!currentUser || currentUser.role !== "wali") window.location.href = "../index.html";

  tanggalInput.value = new Date().toISOString().split("T")[0];
  let dailyData = { program: [], pembelajaran: [], tahfiz: [], pelanggaran: [] };

  // === Tombol Navigasi ===
  window.logout = () => {
  localStorage.removeItem("cahayaCurrentUser");
  window.location.href = "https://multazamzakaria-blip.github.io/cahayaapp/";
};
  window.goDashboard = () => {
    window.location.href = "../dashboard/";
  };

  function badgeStatus(s) {
    s = (s||"").toLowerCase();
    if(s.includes("hadir")) return `<span class="badge badge-hadir">Hadir</span>`;
    if(s.includes("izin")) return `<span class="badge badge-izin">Izin</span>`;
    if(s.includes("sakit")) return `<span class="badge badge-sakit">Sakit</span>`;
    if(s.includes("alfa")) return `<span class="badge badge-alfa">Alfa</span>`;
    return s || "-";
  }

  function renderProgram() {
    if (!dailyData.program.length) return `<div class="card"><div class="card-header">ğŸ“‹ Absensi Program Harian</div><div class="no-data">Belum ada data program hari ini.</div></div>`;
    return `<div class="card"><div class="card-header">ğŸ“‹ Absensi Program Harian</div><table><tr><th>Program</th><th>Status</th></tr>${dailyData.program.map(p=>`<tr><td>${p.program}</td><td>${badgeStatus(p.status)}</td></tr>`).join("")}</table></div>`;
  }
  function renderPembelajaran() {
    if (!dailyData.pembelajaran.length) return `<div class="card"><div class="card-header">ğŸ“˜ Absensi Pembelajaran</div><div class="no-data">Belum ada data pembelajaran hari ini.</div></div>`;
    return `<div class="card"><div class="card-header">ğŸ“˜ Absensi Pembelajaran</div><table><tr><th>Mata Pelajaran</th><th>Status</th></tr>${dailyData.pembelajaran.map(p=>`<tr><td>${p.mapel}</td><td>${badgeStatus(p.status)}</td></tr>`).join("")}</table></div>`;
  }
  function renderTahfiz() {
    if (!dailyData.tahfiz.length) return `<div class="card"><div class="card-header">ğŸ“– Setoran Tahfiz</div><div class="no-data">Belum ada setoran hari ini.</div></div>`;
    return `<div class="card"><div class="card-header">ğŸ“– Setoran Tahfiz</div><table><tr><th>Setoran</th><th>Jumlah Ayat</th><th>Nilai</th></tr>${dailyData.tahfiz.map(t=>`<tr><td>${t.setoran||"-"}</td><td>${t.ayat||"-"}</td><td>${t.nilai||"-"}</td></tr>`).join("")}</table></div>`;
  }
  function renderPelanggaran() {
    if (!dailyData.pelanggaran.length) return `<div class="card"><div class="card-header">âš ï¸ Pelanggaran</div><div class="no-data">Tidak ada pelanggaran hari ini.</div></div>`;
    return `<div class="card"><div class="card-header">âš ï¸ Pelanggaran</div><table><tr><th>Keterangan</th><th>Tindak Lanjut</th><th>Konsekuensi</th></tr>${dailyData.pelanggaran.map(p=>`<tr><td>${p.keterangan||"-"}</td><td>${p.tindakLanjut||"-"}</td><td>${p.konsekuensi||"-"}</td></tr>`).join("")}</table></div>`;
  }

  function renderTab(name){
    panelContainer.innerHTML =
      name==="program" ? renderProgram() :
      name==="pembelajaran" ? renderPembelajaran() :
      name==="tahfiz" ? renderTahfiz() : renderPelanggaran();
  }

  tabsEl.addEventListener("click", e=>{
    const btn = e.target.closest(".tab-btn");
    if(!btn) return;
    document.querySelectorAll(".tab-btn").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    renderTab(btn.dataset.tab);
  });

  async function loadData(tanggal) {
    const nama = (currentUser.namaAnak||"").trim().toUpperCase();
    panelContainer.innerHTML = `<p style="text-align:center;opacity:0.8;">â³ Memuat data...</p>`;
    const root = ref(db);
    const [prog, kbm, tah, pel] = await Promise.all([
      get(child(root,"cahaya_app/absensi_program_harian")),
      get(child(root,"cahaya_app/absensi_pembelajaran")),
      get(child(root,"cahaya_app/setoran_tahfiz")),
      get(child(root,"cahaya_app/pelanggaran_santri"))
    ]);
    const progs=[], kbms=[], tahfizs=[], pels=[];
    if(prog.exists()) Object.values(prog.val()).forEach(a=>{
      if(a.tanggal===tanggal)(a.data||[]).forEach(s=>{
        if((s.nama||"").trim().toUpperCase()===nama) progs.push({program:a.program,status:s.status});
      });
    });
    if(kbm.exists()) Object.values(kbm.val()).forEach(a=>{
      if(a.tanggal===tanggal)(a.data||[]).forEach(s=>{
        if((s.nama||"").trim().toUpperCase()===nama) kbms.push({mapel:a.mapel,status:s.status});
      });
    });
    if(tah.exists()) Object.values(tah.val()).forEach(a=>{
      if(a.tanggal===tanggal)(a.data||[]).forEach(s=>{
        if((s.nama||"").trim().toUpperCase()===nama)tahfizs.push({setoran:s.setoran||s.surat,ayat:s.ayat,nilai:s.nilai});
      });
    });
    if(pel.exists()) Object.values(pel.val()).forEach(p=>{
      if(p.tanggal===tanggal&&(p.santri||"").trim().toUpperCase()===nama)
        pels.push({keterangan:p.keterangan,tindakLanjut:p.tindakLanjut,konsekuensi:p.konsekuensi});
    });

    dailyData={program:progs,pembelajaran:kbms,tahfiz:tahfizs,pelanggaran:pels};
    tabsEl.style.display="flex";
    document.querySelectorAll(".tab-btn").forEach(b=>b.classList.remove("active"));
    document.querySelector('.tab-btn[data-tab="program"]').classList.add("active");
    renderTab("program");
  }

  btnTampil.addEventListener("click", ()=>{
    const tgl = tanggalInput.value;
    if(!tgl) return alert("Pilih tanggal terlebih dahulu");
    loadData(tgl);
  });
</script>
</body>
</html>
