<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>CAHAYA APP ‚Äì Absensi Program Harian</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --primary: #2563eb;
      --primary-dark: #1e40af;
      --border: #e2e8f0;
      --green: #dcfce7;
      --blue: #dbeafe;
      --yellow: #fef9c3;
      --red: #fee2e2;
    }

    body {
      font-family: 'Poppins', Arial, sans-serif;
      background: linear-gradient(135deg, #eef2ff, #e0e7ff);
      color: #1f2937;
      margin: 0;
      padding: 0;
    }

    header {
      background: var(--primary);
      color: white;
      padding: 14px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      border-radius: 0 0 16px 16px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    header h1 {
      margin: 0;
      font-size: 1rem;
      font-weight: 600;
    }

    header button {
      border: none;
      background: rgba(255,255,255,0.15);
      color: white;
      padding: 6px 12px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: 0.25s;
      font-size: 0.9rem;
    }

    header button:hover {
      background: rgba(255,255,255,0.3);
      transform: translateY(-1px);
    }

    main {
      background: white;
      margin: 15px auto;
      padding: 16px;
      border-radius: 16px;
      max-width: 900px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.08);
    }

    h2 {
      color: var(--primary-dark);
      font-weight: 700;
      margin-top: 0;
      font-size: 1.1rem;
    }

    h3 { margin-top: 18px; color: #1f2937; font-size: 1rem; }

    label {
      display: block;
      font-weight: 600;
      margin-top: 10px;
      color: #374151;
    }

    input, select {
      width: 100%;
      padding: 8px 10px;
      border-radius: 6px;
      border: 1px solid var(--border);
      margin-top: 4px;
      box-sizing: border-box;
      font-size: 0.9rem;
    }

    input:focus, select:focus {
      border-color: var(--primary);
      outline: none;
      box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.25);
    }

    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 6px;
    }

    .col {
      flex: 1;
      min-width: 180px;
    }

    .info {
      font-size: 0.8rem;
      color: #475569;
    }

    /* === TABEL === */
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.85rem;
      border-radius: 10px;
      overflow: hidden;
      margin-top: 10px;
    }

    th, td {
      border: 1px solid var(--border);
      padding: 6px;
      text-align: center;
    }

    th {
      background: linear-gradient(90deg, #7ab6ff, #5ea1ff);
      color: white;
      font-weight: 600;
      font-size: 0.9rem;
    }

    td:first-child {
      text-align: left;
      font-weight: 500;
      font-size: 0.9rem;
    }

    /* Warna status */
    tr.status-hadir  { background: var(--green) !important; }
    tr.status-izin   { background: var(--blue) !important; }
    tr.status-sakit  { background: var(--yellow) !important; }
    tr.status-alfa   { background: var(--red) !important; }

    input[type="radio"] {
      accent-color: var(--primary);
      transform: scale(1);
      cursor: pointer;
    }

    /* Tombol */
    button.primary {
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 10px;
      padding: 10px 16px;
      font-weight: 600;
      font-size: 0.95rem;
      margin-top: 16px;
      cursor: pointer;
      width: 100%;
      transition: 0.3s;
    }

    button.primary:hover {
      background: var(--primary-dark);
      transform: translateY(-1px);
    }

    button.secondary {
      background: #6b7280;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 6px 10px;
      font-weight: 600;
      margin-bottom: 8px;
      cursor: pointer;
      font-size: 0.85rem;
    }

    button.secondary:hover { background: #4b5563; }

    /* === RESPONSIVE KHUSUS HP === */
    @media (max-width: 600px) {
      th, td {
        padding: 4px;
        font-size: 0.8rem;
      }

      table {
        table-layout: fixed;
      }

      th:nth-child(1), td:nth-child(1) { width: 40%; }
      th:nth-child(2), td:nth-child(2),
      th:nth-child(3), td:nth-child(3),
      th:nth-child(4), td:nth-child(4),
      th:nth-child(5), td:nth-child(5) { width: 15%; }
    }
  </style>
</head>
<body>

<header>
  <h1>üìã CAHAYA APP ‚Äì Absensi Harian</h1>
  <div>
    <button class="secondary" onclick="goBack()">‚¨ÖÔ∏è Dashboard</button>
    <button onclick="logout()">Keluar</button>
  </div>
</header>

<main>
  <h2 id="naqibTitle">Absensi Program Harian</h2>

  <div class="row">
    <div class="col">
      <label>Tanggal</label>
      <input type="date" id="tanggal">
    </div>
    <div class="col">
      <label>Program</label>
      <select id="program"></select>
      <p class="info">Pastikan program telah sesuai!</p>
    </div>
  </div>

  <h3>Daftar Santri</h3>
  <button type="button" class="secondary" onclick="markAll()">‚úÖ Tandai Semua Hadir</button>

  <table id="tabelSantri">
    <thead>
      <tr>
        <th>Nama Santri</th>
        <th>H</th>
        <th>I</th>
        <th>S</th>
        <th>A</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <button type="button" class="primary" onclick="simpan()">üíæ Simpan Absensi</button>
</main>

<!-- === FIREBASE + LOGIKA ABSENSI (VERSI STABIL) === -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getDatabase, ref, push } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyB0Ez2a85ZwQLR28U-yHpVmM3o8NMxZoLI",
    authDomain: "absensi-santri-fajrul-islam.firebaseapp.com",
    databaseURL: "https://absensi-santri-fajrul-islam-default-rtdb.firebaseio.com",
    projectId: "absensi-santri-fajrul-islam",
    storageBucket: "absensi-santri-fajrul-islam.appspot.com",
    messagingSenderId: "739928369926",
    appId: "1:739928369926:web:7e95375c3ddba0f584cdd07"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const currentUser = JSON.parse(localStorage.getItem('cahayaCurrentUser') || 'null');

  const programHarian = [
    "Shalat Tahajjud","Shalat Subuh","Joging Pagi","Sarapan","Apel Pagi",
    "Makan Siang","Shalat Zuhur","Qailulah","Shalat Ashar",
    "Piket Kebersihan","Makan Sore","Shalat Maghrib","Shalat Isya","Pengecekan Jurnal"
  ];
  const programPekanan = ["Puasa Kamis","Jemur Kasur"];

  const dataSantri = {
    "Regen":[ "AHMAD MAULANA","JUANDA NUR ILHAM","NAJMIHADI SYAUQII TAMAAM","NIZAM KABISAT","MOHAMMAD IKHSAN HAIRULI","REYFAS RAMADHAN","EZA FEBRI AL FADZRI","HAFIDZ AL ROZI","ANDES AFENDRA","FEBRI GHALIH AL FAROBI","DANANG PRASDITYA SANTOSO","MUHAMMAD RAID MAHRUS","MUHAMMAD DIRGATAMA","CANZA RYANDA HUTASUHUT","FALIZH DAFFA QATRUNNADA","DAFFA AL MUSYARI","RAFI RAMADHAN","WAHYU REYDINATA","AKBAR PRAYOGA","VERY SYACH","MUHAMMAD AL FALAH"],
    "Kamal":[ "ADITYA PUTRA IBRAHIM","AIRLANGGA AZKA ABQORI","AQIELA MARSYAH","BRILLY HANDRIAN","DARREN ATHAYA","DZIKRI MUDHOFFAR","ELLENO QUTHBIE HERMAWAN","FADIL NURHALIM","GABRIEL AL FATIH","HADINATA SAPUTRA","MIKO VAJAR","MUHAMMAD ALMISKY PRATAMA","MUHAMMAD AQIL RIDHO","MUHAMMAD IZAM SAPUTRA","MUHAMMAD SYAKIR HUTABARAT","MUHAMMAD ZIYAD ZHAZHA","MUHAMMAD YASIR AL FAZAR JHIRA","RAFA"],
    "Favian":[ "ANGGA PRATAMA PUTRA","PRAWIRO PUJO TUNGGAL JATI","MUHAMMAD MARPIN","MARFEL SAPUTRA","MELDI NOVRIANSYAH","FAUZAN IBNI JABAR","MUHAMMAD FADHIL BUANA","QHEIZAN ALQIZA ARISDA","REZFY FAKHRYAZKA","MIKA RAHEL YUSUF","KI AGUS MUHAMMAD ABDULLAH SHIDDIQ AGTSALI","ARYA DIFA ALSYA","REYNALDI MALIK IBRAHIM ALFARIDZI","MUHAMMAD XAVI NF","MUHAMMAD FAISAL FIKRIANSYAH","HAFIDZ ALRIZKY","NAUFAL AKBAR ALKHATIRI","FARAZH SAYYID PUTRA KENEGA","SYAHRUL RAMADHAN","LUTHFAN ADZAKI","MUHAMMAD ABIL IRWANSYAH","ALIF SAMUDRA","FAHRIE OKTAVIRANO FITRIS"],
    "Dimas":[ "DIKKI KURNIAWAN","GHOZY FATURRAHMAN","MUHAMMAD THOORIQ","AHMAD RIYADI","ALIF MUHAMMAD YUSUF","BASRI AL HAZIQ ZULFAHMI","MUHAMMAD FAQIH HAFIDZALLAH","ABDULLAH MUKTI HAFIDZALLAH","DEDI SETIADI","FAKHRI AL MUZAKKI","ILHAM MUKMIN AL FARABI","MUHAMMAD ALLAM NUR HUSAIN","MUHAMMAD FIRAAS AL INSYIROH","NABIL NAJMI","SATRIO ABIMAYU","TEGAR HIDAYAT","WAFII FADHLURROHMAN","MUHAMMAD RIJALUL KAMIL","ALVIN HERFIANTINO","ZAHIR ZIBRAN","RADEN AZAA PANCA PUTRA","ZULFAKIH HAERUNNASIHIN"],
    "Shafwan":[ "AHMAD FARHAAN","ANUGRAH PRATAMA","CAHYIS ISZAM","FAHRY AKBAR RAMDHANI","HABIB RAMDHAN","IHZA TRINANDI","ILHAM","M.ARYA MAHDI WAFI EL-FAUZANI","MAHESA AULIA GIFFARI","MUHAMAD YUSUF ARROSIYD","MUHAMMAD USAMAH","NAFIS","RAKA SEPTIAN","RENAL MARTIN","ROHADIN FIRDAUS AL QAUSAR","ROID AFDAL"],
    "Fatimah":[ "NILAM CAHYA","QELZA RAMADHANI ATH THAHIRAH","ASHIFA FITRI RAMADHONI","ADIBA AILA KHANZA","AISYAH NUR KHALIFAH","NYAYU MARLITSA ARDHANI","WILDA","WINDY WINDARI","AISYAH NURUL AULIA","NESSYA RAMADHANY","AMIRAH BALQIS RAHADATUL A'ISYAH","EARLYTA ARSYFA SALSABILA","DAFIA NAFLA SYAKIRA","ANISYA SEPTIANI"],
    "Evita":[ "BILQIS NUR ANISAH","JESSICA PUTRY AYRA","GHENIS ANDIENTIAZ","DINA RUHAYAH","PITRI RAMADANI","GRINNETA NALANI PUTRI","INAYAH NOURAH ANINDYA","SHELENA","FITRAH KIRANA"]
  };

  window.init = function() {
    if (!currentUser || currentUser.role !== 'naqib') {
      alert('Silakan login sebagai Naqib melalui portal utama.');
      window.location.href = '../index.html';
      return;
    }

    document.getElementById('naqibTitle').textContent =
      currentUser.label || `Absensi Program Harian (${currentUser.naqibName || ''})`;

    document.getElementById('tanggal').value =
      new Date().toISOString().split('T')[0];

    isiProgram();
    renderSantri(currentUser.naqibName);
  };

  function isiProgram() {
    const select = document.getElementById('program');
    select.innerHTML = '';

    const group1 = document.createElement('optgroup');
    group1.label = 'Program Harian';
    programHarian.forEach(p => {
      const opt = document.createElement('option');
      opt.value = p;
      opt.textContent = p;
      group1.appendChild(opt);
    });
    select.appendChild(group1);

    const group2 = document.createElement('optgroup');
    group2.label = 'Program Pekanan';
    programPekanan.forEach(p => {
      const opt = document.createElement('option');
      opt.value = p;
      opt.textContent = p;
      group2.appendChild(opt);
    });
    select.appendChild(group2);
  }

  function renderSantri(naqibName) {
    const list = dataSantri[naqibName] || [];
    const tbody = document.querySelector('#tabelSantri tbody');
    tbody.innerHTML = '';

    if (!list.length) {
      tbody.innerHTML = `
        <tr>
          <td colspan="5" style="text-align:center;color:#6b7280">
            Belum ada data santri untuk naqib ini.
          </td>
        </tr>`;
      return;
    }

    list.forEach((nama, i) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${nama}</td>
        <td><input type="radio" name="s_${i}" value="Hadir" checked></td>
        <td><input type="radio" name="s_${i}" value="Izin"></td>
        <td><input type="radio" name="s_${i}" value="Sakit"></td>
        <td><input type="radio" name="s_${i}" value="Alfa"></td>
      `;
      tbody.appendChild(tr);

      // default warna Hadir
      tr.classList.add('status-hadir');
      tr.querySelectorAll('input[type="radio"]').forEach(r => {
        r.addEventListener('change', () => {
          tr.classList.remove('status-hadir','status-izin','status-sakit','status-alfa');
          if (r.value === "Hadir") tr.classList.add('status-hadir');
          if (r.value === "Izin")  tr.classList.add('status-izin');
          if (r.value === "Sakit") tr.classList.add('status-sakit');
          if (r.value === "Alfa")  tr.classList.add('status-alfa');
        });
      });
    });
  }

  window.markAll = function() {
    document.querySelectorAll('#tabelSantri tbody tr').forEach(tr => {
      const radio = tr.querySelector('input[value="Hadir"]');
      if (radio) {
        radio.checked = true;
        tr.classList.remove('status-izin','status-sakit','status-alfa');
        tr.classList.add('status-hadir');
      }
    });
  };

  window.simpan = function() {
    const tanggal = document.getElementById('tanggal').value;
    const program = document.getElementById('program').value;
    if (!tanggal || !program) {
      alert('Mohon pilih tanggal dan program terlebih dahulu.');
      return;
    }

    const hasil = [];
    document.querySelectorAll('#tabelSantri tbody tr').forEach((tr, i) => {
      const nama = tr.children[0].textContent;
      const status = document.querySelector(`input[name="s_${i}"]:checked`)?.value || 'Hadir';
      hasil.push({ nama, status });
    });

    const log = {
      tanggal,
      program,
      naqib: currentUser.naqibName,
      data: hasil,
      waktuSimpan: new Date().toISOString()
    };

    const absensiRef = ref(db, 'cahaya_app/absensi_program_harian');
    push(absensiRef, log)
      .then(() => alert(`‚úÖ Absensi ${program} (${tanggal}) tersimpan ke Firebase.`))
      .catch(err => alert('‚ùå Gagal menyimpan ke Firebase: ' + err.message));
  };

  window.goBack = function() {
    window.location.href = 'dashboard.html';
  };

  window.logout = function() {
    localStorage.removeItem('cahayaCurrentUser');
    window.location.href = '../index.html';
  };

  document.addEventListener('DOMContentLoaded', init);
</script>

</body>
</html>
